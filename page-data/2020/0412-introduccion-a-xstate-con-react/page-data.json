{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020/0412-introduccion-a-xstate-con-react/","result":{"data":{"site":{"siteMetadata":{"title":"Platzi Master"}},"markdownRemark":{"id":"265139c8-8d08-5a89-84fd-9295e4c29173","excerpt":"Videojuegos\nEl desarrollo de UI se ha hecho más difícil debido a que ahora manejamos estados de la aplicación en el navegador, lo cuál aumenta la complejidad en…","html":"<p><img src=\"https://images.unsplash.com/photo-1531812494838-636e337af5a6?ixlib=rb-1.2.1&#x26;ixid=eyJhcHBfaWQiOjEyMDd9&#x26;auto=format&#x26;fit=crop&#x26;w=1950&#x26;q=80\" alt=\"Videojuegos\">\nEl desarrollo de UI se ha hecho más difícil debido a que ahora manejamos estados de la aplicación en el navegador, lo cuál aumenta la complejidad en el desarrollo y en el control de bugs, y la mayoría de bugs tienen que ver con estados mal manejados o con intersecciones entre estados.</p>\n<p>La forma en que manejamos los estados en React no son escalables, reutilizables o facilmente testeables. Para hacer un Fetch generamos mucha configuración para manejar el estado de loading, hasError, hasSucces y si queremos pasar esa lógica tenemos que escribirla una y otra vez.</p>\n<iframe\n  src=\"https://codesandbox.io/embed/fetching-norma-react-yoshuadiaz-qjfio?fontsize=14&hidenavigation=1&theme=dark\"\n  style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\"\n  title=\"fetching-norma-react-yoshuadiaz\"\n  allow=\"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb\"\n  sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"\n></iframe>\n<p>Manejar mal un estado puede traer consecuencias catastróficas, si un semaforo tuviera prendidos las luces verde y roja al mismo tiempo sería algo que seguro causaría algunos accidentes o mucho tráfico, a veces necesitamos que sólo exista un estado y saber qué estado es el siguiente, es decir, necesitamos un flujo claro para saber como pasar de un estado a otro, y que sólo exista un estado a la vez. Eso se soluciona con las máquinas de estado finito.</p>\n<h2>Máquinas de estado finito</h2>\n<p>Los enemigos de videojuegos no usan IA de verdad en la mayoría de los casos, ellos no aprenden de las partidas, ellos reaccionan a eventos que los lleva a un estado que hace que te persigan, te ataquen, recarguen munción o mueran, eso lo logran con las Máquinas de estado finito.</p>\n<p><img src=\"https://gamedevn.files.wordpress.com/2015/04/screen-shot-2015-04-11-at-13-02-44.png\" alt=\"IA de enemigo con máquina de estado finito\"></p>\n<p>Las máquinas de estado finito trata de una máquina que puede tener muchos estados pero sólo puede estar en uno de ellos en un momento determinado, cómo los enemigos de los videojuegos, lo cuál hace que sea más predecible como se pasa de un estado a otro, como en el semaforo, sabemos que respetara la secuencia y que no hará cosas alocadas como prender o apagarse al ritmo de una canción, es decir, sólo tiene una cantidad finita de estados, y esa limitación nos sirve mucho para el manejo de UI.</p>\n<p>Por ejemplo, podemos ver un state machine de un Fetch y es más sencillo:\n<img src=\"https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_2000/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/c2f37efe-a89c-48fd-9176-f289aa05ccd6/sm-high-res-opt.jpg\" alt=\"State Machine de un fetch\"></p>\n<p>En esta lógica:</p>\n<ul>\n<li><strong>IDLE</strong> sería nuestro punto de inicio, cómo cuando un personaje de videojuegos se queda quieto y solo corre la animación de como respira y parpadea y solo puede mandar el evento <strong>click</strong> que hará que la máquina entre en estado <strong>Fetching</strong> y no a error u otro estado.</li>\n<li><strong>Fetching</strong>: este estado podría bloquear los botones, mostrar el mensaje de carga e iniciar la petición con fetch, y dependiendo del resultado lanzar uno de dos eventos: <strong>failure</strong> o <strong>success</strong> y dependiendo de lo que haga puede ir al estado <strong>idle</strong> o a <strong>error</strong></li>\n<li><strong>Error</strong>: en este estado sólo podemos mandar el evento de reintentar, lo cuál nos permite manejar lógica para que se haga ese reintento de forma automática o limitar el número de reintentos.</li>\n</ul>\n<p>Todo eso suena genial pero ¿cómo lo implementamos?, una librería genial se llama xState.</p>\n<h2>Introducción a xState</h2>\n<p>Para definir una máquina de estado con xState escribimos primero los estados que ocurrirán de esta forma:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createMachine <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'xstate'</span>\n\n<span class=\"token keyword\">const</span> maquinaDeFetch <span class=\"token operator\">=</span> <span class=\"token function\">createMachine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  id<span class=\"token operator\">:</span> <span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span>\n  initial<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// Lista de estados</span>\n  states<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    idle<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    fetching<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Definimos como se hará la transición</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Machine <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'xstate'</span>\n\n<span class=\"token keyword\">const</span> maquinaDeFetch <span class=\"token operator\">=</span> <span class=\"token function\">Machine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  id<span class=\"token operator\">:</span> <span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span>\n  initial<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n  states<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    idle<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Definimos con 'on' el evento y a donde irá</span>\n      on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        click<span class=\"token operator\">:</span> <span class=\"token string\">'fetching'</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    fetching<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Definimos con 'on' el evento y a donde irá</span>\n      on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        failure<span class=\"token operator\">:</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>\n        success<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Definimos con 'on' el evento y a donde irá</span>\n      on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        retry<span class=\"token operator\">:</span> <span class=\"token string\">'fetching'</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Y aquí mostraré como usar la máquina con el ejemplo anterior con un servicio para hacer el fetch dinámico:</p>\n<iframe\n  src=\"https://codesandbox.io/embed/finite-state-machine-yoshuadiaz-f7d47?fontsize=14&hidenavigation=1&theme=dark\"\n  style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\"\n  title=\"finite-state-machine-yoshuadiaz\"\n  allow=\"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb\"\n  sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"\n></iframe>\n<h2>Recursos para saber más:</h2>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=VU1NKX6Qkxc\">Charla del creador de xState</a></li>\n<li><a href=\"http://xstate.js.org/\">Sitio de xState</a></li>\n<li><a href=\"https://css-tricks.com/using-react-and-xstate-to-build-a-sign-in-form/\">Un post cool sobre xState y las máquinas de estado</a></li>\n<li><a href=\"https://frontstuff.io/using-state-machines-in-vuejs-with-xstate\">Cómo usarlas con Vue.js</a></li>\n</ul>\n<p>Si te sirvió este post sigamos la conversación por Twitter <a href=\"https://twitter.com/yoshuadiaz\">@Yoshua Díaz</a> o visítame en <a href=\"https://www.yoshuadiaz.com\">mi sitio web</a></p>","frontmatter":{"title":"IA de videojuegos al servicio de la UI","date":"April 12, 2020","description":"Aprende qué son y cómo usar máquinas de estado finito para manejar el estado de tu UI","author":"Yoshua Díaz","email":"yoshua.sdiaz@gmail.com","platziUser":"yoshua_diaz"}}},"pageContext":{"slug":"/2020/0412-introduccion-a-xstate-con-react/","previous":{"fields":{"slug":"/2020/0411-Github-tips-tricks-hacks/"},"frontmatter":{"title":"Github: Tips, tricks y hacks"}},"next":{"fields":{"slug":"/2020/0414-la-maquinaria-matematica-detras-de-la-r/"},"frontmatter":{"title":"La maquinaria matemática detrás de la recursión"}}}}}